# 1Panel Docker éƒ¨ç½²é…ç½®è¯´æ˜

## ğŸ“‹ å‰ç½®å‡†å¤‡

### 1. ä¸Šä¼ é¡¹ç›®åˆ° 1Panel

```bash
# å‡è®¾ä½ çš„é¡¹ç›®åœ¨æœåŠ¡å™¨ä¸Šçš„è·¯å¾„
# /root/panhub.shenzjd.com
```

### 2. ç¡®ä¿é¡¹ç›®åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
- âœ… `Dockerfile`
- âœ… `docker-compose.yml`
- âœ… `package.json`
- âœ… `pnpm-lock.yaml`

---

## ğŸ”§ 1Panel é…ç½®æ­¥éª¤

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰

#### æ­¥éª¤ 1ï¼šåˆ›å»º Compose é¡¹ç›®

1. ç™»å½• 1Panel é¢æ¿
2. è¿›å…¥ **å®¹å™¨** â†’ **Compose é¡¹ç›®**
3. ç‚¹å‡» **åˆ›å»º Compose é¡¹ç›®**
4. å¡«å†™ä¿¡æ¯ï¼š
   - **é¡¹ç›®åç§°**ï¼š`panhub`
   - **è·¯å¾„**ï¼š`/root/panhub.shenzjd.com`
   - **Compose æ–‡ä»¶**ï¼šé€‰æ‹© `docker-compose.yml`
5. ç‚¹å‡» **ç¡®è®¤**

#### æ­¥éª¤ 2ï¼šéªŒè¯éƒ¨ç½²

1. è¿›å…¥ **å®¹å™¨** â†’ **å®¹å™¨åˆ—è¡¨**
2. æ‰¾åˆ° `panhub-panhub-1` å®¹å™¨
3. ç‚¹å‡» **æ—¥å¿—**ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   [HotSearchSQLite] âœ… SQLite æ•°æ®åº“å·²åˆå§‹åŒ–: ./data/hot-searches.db
   ```

---

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨åˆ›å»ºå®¹å™¨

#### æ­¥éª¤ 1ï¼šæ„å»ºé•œåƒ

åœ¨ 1Panel çš„ **ç»ˆç«¯** ä¸­æ‰§è¡Œï¼š

```bash
cd /root/panhub.shenzjd.com
docker build -t panhub:latest .
```

#### æ­¥éª¤ 2ï¼šåˆ›å»ºå®¹å™¨

1. è¿›å…¥ **å®¹å™¨** â†’ **å®¹å™¨åˆ—è¡¨** â†’ **åˆ›å»ºå®¹å™¨**
2. **åŸºç¡€è®¾ç½®**ï¼š
   - å®¹å™¨åç§°ï¼š`panhub`
   - é•œåƒï¼š`panhub:latest`
   - é‡å¯ç­–ç•¥ï¼š`always`

3. **ç«¯å£é…ç½®**ï¼š
   - å®¿ä¸»æœºç«¯å£ï¼š`3000`
   - å®¹å™¨ç«¯å£ï¼š`3000`
   - åè®®ï¼š`TCP`

4. **ç›®å½•æŒ‚è½½**ï¼ˆ**æœ€å…³é”®**ï¼‰ï¼š

   ç‚¹å‡» **æ·»åŠ æŒ‚è½½**ï¼Œé…ç½®ï¼š

   | ç±»å‹ | å®¿ä¸»æœºè·¯å¾„ | å®¹å™¨è·¯å¾„ | è¯´æ˜ |
   |------|-----------|---------|------|
   | ç›®å½• | `/root/panhub/data` | `/app/data` | SQLite æ•°æ®æŒä¹…åŒ– |

   **é‡è¦**ï¼š
   - å®¿ä¸»æœºè·¯å¾„å¿…é¡»æ˜¯**ç»å¯¹è·¯å¾„**
   - å»ºè®®åˆ›å»ºä¸“ç”¨ç›®å½•ï¼š`mkdir -p /root/panhub/data`
   - ç¡®ä¿æœ‰å†™æƒé™ï¼š`chmod 777 /root/panhub/data`

5. **ç¯å¢ƒå˜é‡**ï¼š

   ç‚¹å‡» **æ·»åŠ ç¯å¢ƒå˜é‡**ï¼š

   | å˜é‡å | å€¼ | è¯´æ˜ |
   |--------|-----|------|
   | `NODE_ENV` | `production` | ç”Ÿäº§ç¯å¢ƒ |
   | `PORT` | `3000` | ç«¯å£ |
   | `HOST` | `0.0.0.0` | ç›‘å¬åœ°å€ |
   | `HOT_SEARCH_PASSWORD` | `admin123` | ç®¡ç†å¯†ç ï¼ˆå¯è‡ªå®šä¹‰ï¼‰ |
   | `LOG_LEVEL` | `info` | æ—¥å¿—çº§åˆ« |

6. **èµ„æºé™åˆ¶**ï¼š
   - å†…å­˜ï¼š`512 MB`ï¼ˆæœ€å°ï¼‰
   - CPUï¼š`0.5 æ ¸`

7. **é«˜çº§è®¾ç½®**ï¼š
   - **å·¥ä½œç›®å½•**ï¼š`/app`
   - **å‘½ä»¤**ï¼šç•™ç©ºï¼ˆä½¿ç”¨ Dockerfile é»˜è®¤ï¼‰

8. **åˆ›å»ºå¹¶å¯åŠ¨**

---

## âœ… éƒ¨ç½²åéªŒè¯

### 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€

åœ¨ 1Panel çš„ **ç»ˆç«¯** æˆ– SSHï¼š

```bash
docker ps | grep panhub
```

åº”è¯¥çœ‹åˆ°å®¹å™¨æ­£åœ¨è¿è¡Œã€‚

### 2. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—

åœ¨ 1Panel ä¸­ï¼š
- è¿›å…¥ **å®¹å™¨** â†’ **å®¹å™¨åˆ—è¡¨**
- ç‚¹å‡» `panhub` å®¹å™¨
- ç‚¹å‡» **æ—¥å¿—**

æˆ–è€…å‘½ä»¤è¡Œï¼š
```bash
docker logs panhub 2>&1 | grep HotSearchSQLite
```

**æˆåŠŸæ ‡å¿—**ï¼š
```
[HotSearchSQLite] âœ… SQLite æ•°æ®åº“å·²åˆå§‹åŒ–: ./data/hot-searches.db
[HotSearchSQLite] âœ… è¡¨ç»“æ„å·²åˆ›å»º/éªŒè¯å®Œæˆ
```

**å¤±è´¥æ ‡å¿—**ï¼š
```
[HotSearchSQLite] âš ï¸ é™çº§åˆ°å†…å­˜æ¨¡å¼: ...
```

### 3. æµ‹è¯•æœç´¢åŠŸèƒ½

1. è®¿é—® `http://ä½ çš„æœåŠ¡å™¨IP:3000`
2. æœç´¢ä»»æ„å…³é”®è¯ï¼ˆå¦‚ï¼š`ç”µå½±`ï¼‰
3. æŸ¥çœ‹æ—¥å¿—ï¼š
   ```bash
   docker logs panhub 2>&1 | grep SearchService
   ```

   åº”è¯¥çœ‹åˆ°ï¼š
   ```
   [SearchService] ğŸ” ç”¨æˆ·æœç´¢: "ç”µå½±"
   [HotSearchSQLite] âœ… è®°å½•æœç´¢è¯: "ç”µå½±"
   [SearchService] âœ… æœç´¢å®Œæˆ keyword="ç”µå½±" total=25
   ```

### 4. éªŒè¯æ•°æ®åº“æ–‡ä»¶

```bash
# æ£€æŸ¥å®¹å™¨å†…æ•°æ®åº“æ–‡ä»¶
docker exec panhub ls -la /app/data/

# åº”è¯¥çœ‹åˆ°ï¼š
# hot-searches.db
```

### 5. æ£€æŸ¥æŒä¹…åŒ–

```bash
# æŸ¥çœ‹æ•°æ®åº“ç»Ÿè®¡
curl http://localhost:3000/api/hot-search-stats
```

è¿”å›ç¤ºä¾‹ï¼š
```json
{
  "code": 0,
  "data": {
    "stats": {
      "total": 3,
      "topTerms": [...]
    },
    "dbSizeMB": 0.01,
    "dbExists": true,
    "isMemoryMode": false,
    "mode": "sqlite"
  }
}
```

### 6. é‡å¯æµ‹è¯•æ•°æ®ä¿ç•™

```bash
# é‡å¯å®¹å™¨
docker restart panhub

# ç­‰å¾…å¯åŠ¨åï¼Œå†æ¬¡æ£€æŸ¥ç»Ÿè®¡
curl http://localhost:3000/api/hot-search-stats
```

å¦‚æœ `total` æ•°é‡ä¸å˜ï¼Œè¯´æ˜æŒä¹…åŒ–æˆåŠŸï¼

---

## ğŸ” é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šå®¹å™¨å¯åŠ¨å¤±è´¥

**æ£€æŸ¥**ï¼š
```bash
docker logs panhub
```

**å¸¸è§åŸå› **ï¼š
- ç«¯å£è¢«å ç”¨ï¼šä¿®æ”¹ 1Panel ä¸­çš„å®¿ä¸»æœºç«¯å£
- é•œåƒæ„å»ºå¤±è´¥ï¼šé‡æ–°æ„å»ºé•œåƒ

### é—®é¢˜ 2ï¼šSQLite é™çº§åˆ°å†…å­˜æ¨¡å¼

**åŸå› **ï¼šbetter-sqlite3 æœªæ­£ç¡®å®‰è£…æˆ–ç¼–è¯‘

**æ£€æŸ¥**ï¼š
```bash
# è¿›å…¥å®¹å™¨
docker exec -it panhub sh

# å°è¯•åŠ è½½ better-sqlite3
node -e "console.log(require('better-sqlite3'))"
```

**è§£å†³**ï¼š
1. ç¡®ä¿ä½¿ç”¨æˆ‘æä¾›çš„ Dockerfileï¼ˆå·²åŒ…å«æ­£ç¡®é…ç½®ï¼‰
2. é‡æ–°æ„å»ºé•œåƒï¼š
   ```bash
   docker build --no-cache -t panhub:latest .
   ```

### é—®é¢˜ 3ï¼šæ•°æ®ä¸æŒä¹…åŒ–

**æ£€æŸ¥æŒ‚è½½**ï¼š
```bash
# åœ¨å®¹å™¨å†…åˆ›å»ºæ–‡ä»¶
docker exec panhub touch /app/data/test.txt

# æ£€æŸ¥å®¿ä¸»æœºæ˜¯å¦ä¹Ÿæœ‰
ls -la /root/panhub/data/
```

å¦‚æœå®¿ä¸»æœºæ²¡æœ‰ `test.txt`ï¼Œè¯´æ˜æŒ‚è½½å¤±è´¥ï¼Œéœ€è¦ï¼š
1. æ£€æŸ¥ 1Panel çš„æŒ‚è½½é…ç½®
2. ç¡®ä¿å®¿ä¸»æœºç›®å½•å­˜åœ¨ä¸”æœ‰æƒé™

### é—®é¢˜ 4ï¼šæƒé™é”™è¯¯

**é”™è¯¯æ—¥å¿—**ï¼š
```
Error: EACCES: permission denied
```

**è§£å†³**ï¼š
```bash
# åœ¨å®¿ä¸»æœºæ‰§è¡Œ
chmod -R 777 /root/panhub/data
```

---

## ğŸ“Š ç›‘æ§å‘½ä»¤

### æŸ¥çœ‹å®æ—¶æ—¥å¿—
```bash
docker logs -f panhub
```

### æŸ¥çœ‹æ•°æ®åº“å¤§å°
```bash
docker exec panhub ls -lh /app/data/hot-searches.db
```

### æŸ¥çœ‹å½“å‰çƒ­æœ
```bash
curl http://localhost:3000/api/hot-searches?limit=10
```

### æ¸…ç©ºçƒ­æœï¼ˆéœ€è¦å¯†ç ï¼‰
```bash
curl -X POST http://localhost:3000/api/clear-hot-searches \
  -H "Content-Type: application/json" \
  -d '{"password":"admin123"}'
```

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

éƒ¨ç½²æˆåŠŸåï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

1. âœ… å®¹å™¨æ­£å¸¸è¿è¡Œ
2. âœ… æ—¥å¿—æ˜¾ç¤º `âœ… SQLite æ•°æ®åº“å·²åˆå§‹åŒ–`
3. âœ… æœç´¢åæ—¥å¿—æ˜¾ç¤º `âœ… è®°å½•æœç´¢è¯`
4. âœ… `/app/data/` ç›®å½•ä¸‹æœ‰ `hot-searches.db`
5. âœ… é‡å¯å®¹å™¨åæ•°æ®ä¸ä¸¢å¤±
6. âœ… è®¿é—® `/api/hot-search-stats` æ˜¾ç¤º `"mode": "sqlite"`

---

## ğŸ’¡ å°è´´å£«

### è‡ªåŠ¨å¤‡ä»½ï¼ˆå¯é€‰ï¼‰

åœ¨ 1Panel ä¸­è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼š

```bash
# æ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½æ•°æ®åº“
0 2 * * * cp /root/panhub/data/hot-searches.db /backup/panhub-$(date +\%Y\%m\%d).db
```

### ä¿®æ”¹ç®¡ç†å¯†ç 

åœ¨ 1Panel çš„ç¯å¢ƒå˜é‡ä¸­ä¿®æ”¹ï¼š
- å˜é‡åï¼š`HOT_SEARCH_PASSWORD`
- å€¼ï¼š`ä½ çš„æ–°å¯†ç `

ç„¶åé‡å¯å®¹å™¨ã€‚

### æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨

åœ¨ 1Panel çš„ **å®¹å™¨** â†’ **å®¹å™¨åˆ—è¡¨** ä¸­æŸ¥çœ‹ï¼š
- CPU ä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨é‡
- ç½‘ç»œæµé‡

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤ä»ç„¶æ— æ³•è§£å†³ SQLite æŒä¹…åŒ–é—®é¢˜ï¼Œè¯·æä¾›ï¼š

1. `docker logs panhub` çš„å®Œæ•´è¾“å‡º
2. 1Panel ä¸­çš„æŒ‚è½½é…ç½®æˆªå›¾
3. æ‰§è¡Œ `docker exec panhub ls -la /app/data/` çš„ç»“æœ

æˆ‘ä¼šæ ¹æ®è¿™äº›ä¿¡æ¯å¸®ä½ è¿›ä¸€æ­¥æ’æŸ¥ï¼
